
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OneDrive Picker + Graph API</title>
  <script src="https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js"></script>
  <script src="https://js.live.net/v7.2/OneDrive.js"></script>
</head>
<body>
  <h2>ğŸ” OneDrive åŸç”Ÿé¸æ“‡å™¨æ¸¬è©¦</h2>
  <button onclick="signIn()">1ï¸âƒ£ ç™»å…¥ Microsoft</button>
  <button onclick="openOneDrive()">2ï¸âƒ£ é–‹å•Ÿ OneDrive File Picker</button>
  <pre id="output"></pre>

  <script>
    const msalConfig = {
      auth: {
        clientId: "0e84f375-3253-4903-a67b-8c26ec405793", // <<<<<<<< æ›æˆä½ è‡ªå·±çš„
        authority: "https://login.microsoftonline.com/be2d5505-f7e6-4600-bbe2-b3201c91b344", // <<<<<<<< æ›æˆä½ è‡ªå·±çš„
        redirectUri: "https://onedrive-picker.vercel.app/"
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);
    let accessToken = "";

    async function signIn() {
      try {
        const loginResponse = await msalInstance.loginPopup({
          scopes: ["Files.Read.All"]
        });
        accessToken = loginResponse.accessToken;
        document.getElementById("output").innerText = "âœ… ç™»å…¥æˆåŠŸï¼ŒAccess Token å·²å–å¾—";
      } catch (err) {
        console.error(err);
        alert("ç™»å…¥å¤±æ•—ï¼");
      }
    }

    function openOneDrive() {
      if (!accessToken) {
        alert("è«‹å…ˆç™»å…¥ï¼");
        return;
      }

      OneDrive.open({
        clientId: msalConfig.auth.clientId,
        action: "query",
        multiSelect: false,
        advanced: {
          accessToken: accessToken
        },
      
        success: function (files) {
  console.log("âœ… OneDrive Picker å›å‚³ï¼š", files);

  const fileArray = files?.value || [];
  if (!Array.isArray(fileArray) || fileArray.length === 0) {
    document.getElementById("output").innerText = "âš ï¸ æ²’æœ‰é¸æ“‡ä»»ä½•æª”æ¡ˆ";
    return;
  }

  const file = fileArray[0];
  document.getElementById("output").innerText =
    "âœ… é¸æ“‡æª”æ¡ˆæˆåŠŸï¼š\n" +
    "ğŸ“„ æª”åï¼š" + file.name + "\n" +
    "ğŸ“¦ æª”æ¡ˆå¤§å°ï¼š" + file.size + " bytes\n" +
    "ğŸ”— ä¸‹è¼‰é€£çµï¼š" + file['@microsoft.graph.downloadUrl'];
},
        cancel: function () {
          document.getElementById("output").innerText = "âš ï¸ ä½¿ç”¨è€…å–æ¶ˆé¸æ“‡";
        },
       error: function (e) {
          console.error("âŒ OneDrive Picker ç™¼ç”ŸéŒ¯èª¤ï¼š", e);  // â† console é¡¯ç¤ºå®Œæ•´éŒ¯èª¤
          document.getElementById("output").innerText =
          "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š\\n" + JSON.stringify(e, null, 2);  // â† HTML æ ¼å¼åŒ–é¡¯ç¤ºéŒ¯èª¤
}
      });
    }
  </script>
</body>
</html>
